<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Caption Generator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- LOGIN SCREEN -->
  <section id="loginScreen" class="login-section">
    <div class="login-box" title="Click here to switch login input theme">
      <h1><span class="brand">Promptly</span></h1>
      <h2>AI Caption Generator</h2>
      <input type="text" id="username" placeholder="Enter your username" />
      <input type="password" id="password" placeholder="Enter your password" />
      <button id="loginBtn">Log In</button>
      <p style="font-size:0.85rem; margin-top: 10px; color: #ccc; user-select:none;">
        Click here to switch login input theme
      </p>
    </div>
  </section>

  <!-- APP SCREEN (Hidden Initially) -->
  <div id="app" class="hidden">
    <nav class="navbar">
      <div class="nav-left">
        <button id="homeBtn" class="nav-btn active">Home</button>
        <button id="historyBtn" class="nav-btn">History</button>
        <button id="themeBtn" class="nav-btn">Theme</button>
      </div>
    </nav>

    <main>
      <!-- Home -->
      <section id="mainScreen" class="screen">
        <div class="container">
          <h1>‚ú® Welcome, <span id="displayUser"></span>!</h1>
          <textarea id="userInput" placeholder="Write your idea for the post..."></textarea>
          <button id="generateBtn">Generate üî•</button>
          <button id="clearBtn">Reset</button>
          <div class="loading" id="loading">‚è≥ Generating with AI...</div>
          <div class="output" id="output"></div>

          <button id="micBtn">üéôÔ∏è Speak</button>

        </div>
      </section>

      <!-- History -->
      <section id="historyScreen" class="screen hidden">
        <div class="container">
          <h2>üìú History</h2>
          <div id="historyContent" class="history"></div>
        </div>
      </section>

      <!-- Theme -->
      <section id="themeScreen" class="screen hidden">
        <div class="container theme-container">
          <h2>üé® Select Theme</h2>
          <!-- Old toggle kept for backward compatibility -->
          <button id="toggleThemeBtn" class="btn-primary">Switch to Dark Theme üåô</button>

          <!-- New 7-theme cycle button -->
          <button id="cycleThemeBtn" class="btn-primary" style="margin-top: 1rem;">Cycle 7 Beautiful Themes</button>
        </div>
      </section>
    </main>
  </div>

  <!-- SCRIPT SECTION -->
  <script type="module">
    import {
      GoogleGenerativeAI,
    } from "https://cdn.jsdelivr.net/npm/@google/generative-ai@latest/+esm";

    const API_KEY = "AIzaSyBQyHsAsXAjHITGh5-WEnpHXRTx0UinBSs";
    const genAI = new GoogleGenerativeAI(API_KEY);

    async function generatePost() {
      const input = document.getElementById("userInput").value.trim();
      const output = document.getElementById("output");
      const loading = document.getElementById("loading");

      if (!input) {
        alert("Please enter your post idea.");
        return;
      }

      output.innerHTML = "";
      loading.style.display = "block";

      try {
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
        const prompt = `Create two social media post options from this idea: "${input}"
        Include the following:
        - Caption
        - Emojis
        - Description
        - Hashtags
        Label them clearly as "Option 1" and "Option 2". Format clearly.`;

        const result = await model.generateContent(prompt);
        const response = await result.response;
        const responseText = await response.text();

        const cleanHTML = formatResponse(responseText);
        loading.style.display = "none";
        output.innerHTML = cleanHTML;
        saveToHistory(cleanHTML);
      } catch (err) {
        loading.style.display = "none";
        output.innerHTML = `‚ùå Error: ${err.message}`;
      }
      const synth = window.speechSynthesis;
      const utterance = new SpeechSynthesisUtterance(cleanHTML.replace(/<[^>]+>/g, ''));
      utterance.lang = 'en-US';
      synth.speak(utterance);

    }

    function formatResponse(text) {
      const lines = text.split(/\n+/);
      let html = "";
      lines.forEach((line) => {
        const trimmed = line.trim();
        if (/^alternative.*post/i.test(trimmed)) {
          html += `<br><hr><h3>üîÅ <strong>Alternative Post:</strong></h3><br>`;
        } else if (/^image:/i.test(trimmed)) {
          html += `üñºÔ∏è <strong>Image:</strong> ${trimmed.replace(/image:/i, "").trim()}<br><br>`;
        } else if (/^caption:/i.test(trimmed)) {
          html += `üìù <strong>Caption:</strong> ${trimmed.replace(/caption:/i, "").trim()}<br><br>`;
        } else if (/^description:/i.test(trimmed)) {
          html += `üìñ <strong>Description:</strong> ${trimmed.replace(/description:/i, "").trim()}<br><br>`;
        } else if (/^hashtags:/i.test(trimmed)) {
          html += `üè∑Ô∏è <strong>Hashtags:</strong> ${trimmed.replace(/hashtags:/i, "").trim()}<br><br>`;
        } else if (trimmed.length > 0) {
          html += `${trimmed}<br><br>`;
        }
      });
      return html;
    }

    function saveToHistory(content) {
      const history = JSON.parse(localStorage.getItem("postHistory")) || [];
      history.unshift({ content, timestamp: new Date().toLocaleString() });
      localStorage.setItem("postHistory", JSON.stringify(history.slice(0, 15)));
    }

    function loadHistory() {
      const historyData = JSON.parse(localStorage.getItem("postHistory")) || [];
      const container = document.getElementById("historyContent");

      container.innerHTML = historyData.length === 0
        ? "<p>No history yet.</p>"
        : historyData.map(entry => `
          <div class="history-item">
            <small>üïì ${entry.timestamp}</small>
            <div class="history-content">${entry.content}</div>
            <hr />
          </div>
        `).join("");
    }

    // LOGIN LOGIC
    document.getElementById("loginBtn").addEventListener("click", () => {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        alert("Please enter username and password.");
        return;
      }

      document.getElementById("displayUser").textContent = username;
      document.getElementById("loginScreen").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
    });

    // THEME SWITCH FOR APP (light/dark) - old toggle
    const toggleThemeBtn = document.getElementById("toggleThemeBtn");

    function updateThemeToggleText() {
      toggleThemeBtn.textContent = document.body.classList.contains("dark-theme")
        ? "Switch to Light Theme ‚òÄÔ∏è"
        : "Switch to Dark Theme üåô";
    }

    toggleThemeBtn.addEventListener("click", () => {
      document.body.classList.toggle("dark-theme");
      document.body.classList.toggle("light-theme");
      updateThemeToggleText();
    });

    // NAVIGATION
    const mainScreen = document.getElementById("mainScreen");
    const historyScreen = document.getElementById("historyScreen");
    const themeScreen = document.getElementById("themeScreen");

    const homeBtn = document.getElementById("homeBtn");
    const historyBtn = document.getElementById("historyBtn");
    const themeBtn = document.getElementById("themeBtn");

    function setActiveNav(btn) {
      [homeBtn, historyBtn, themeBtn].forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }

    homeBtn.addEventListener("click", () => {
      mainScreen.classList.remove("hidden");
      historyScreen.classList.add("hidden");
      themeScreen.classList.add("hidden");
      setActiveNav(homeBtn);
    });

    historyBtn.addEventListener("click", () => {
      mainScreen.classList.add("hidden");
      historyScreen.classList.remove("hidden");
      themeScreen.classList.add("hidden");
      loadHistory();
      setActiveNav(historyBtn);
    });

    themeBtn.addEventListener("click", () => {
      mainScreen.classList.add("hidden");
      historyScreen.classList.add("hidden");
      themeScreen.classList.remove("hidden");
      updateThemeToggleText();
      setActiveNav(themeBtn);
    });

    // INIT
    document.body.classList.add("light-theme");
    setActiveNav(homeBtn);

    // Buttons
    document.getElementById("generateBtn").addEventListener("click", generatePost);
    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("output").innerHTML = "";
      document.getElementById("loading").style.display = "none";
      document.getElementById("userInput").value = "";
    });

    // Microphone button logic using Web Speech API
const micBtn = document.getElementById("micBtn");
const userInput = document.getElementById("userInput");

// Check browser support
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  micBtn.disabled = true;
  micBtn.textContent = "üéôÔ∏è Not supported";
} else {
  const recognition = new SpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  micBtn.addEventListener("click", () => {
    micBtn.textContent = "üé§ Listening...";
    recognition.start();
  });

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    userInput.value = transcript;
    micBtn.textContent = "üéôÔ∏è Speak";
    generatePost(); // Automatically generate after recognition
  };

  recognition.onerror = (event) => {
    alert("Voice error: " + event.error);
    micBtn.textContent = "üéôÔ∏è Speak";
  };

  recognition.onend = () => {
    micBtn.textContent = "üéôÔ∏è Speak";
  };
}


    // LOGIN INPUTS THEME CYCLE (7 themes)
    const loginSection = document.getElementById("loginScreen");
    const loginBox = loginSection.querySelector(".login-box");

    let currentLoginTheme = 1;
    const maxLoginThemes = 7;

    loginBox.style.cursor = "pointer";

    loginBox.addEventListener("click", () => {
      loginSection.classList.remove(`login-theme-${currentLoginTheme}`);

      currentLoginTheme = currentLoginTheme === maxLoginThemes ? 1 : currentLoginTheme + 1;

      loginSection.classList.add(`login-theme-${currentLoginTheme}`);
    });


    // NEW: APP 7 THEME CYCLE FEATURE

    const cycleThemeBtn = document.getElementById("cycleThemeBtn");

    const appThemes = [
      "theme-1",
      "theme-2",
      "theme-3",
      "theme-4",
      "theme-5",
      "theme-6",
      "theme-7"
    ];

    let currentAppThemeIndex = 0;

    function applyAppTheme(index) {
      // Remove all theme classes first
      appThemes.forEach(theme => document.body.classList.remove(theme));

      // Also remove light and dark so they don't conflict
      document.body.classList.remove("light-theme");
      document.body.classList.remove("dark-theme");

      // Add selected theme
      document.body.classList.add(appThemes[index]);
    }

    function updateCycleThemeBtnText() {
      const themeName = appThemes[currentAppThemeIndex].replace("-", " ").toUpperCase();
      cycleThemeBtn.textContent = `Cycle 7 Beautiful Themes: ${themeName}`;
    }

    cycleThemeBtn.addEventListener("click", () => {
      currentAppThemeIndex = (currentAppThemeIndex + 1) % appThemes.length;
      applyAppTheme(currentAppThemeIndex);
      updateCycleThemeBtnText();
    });

    // Initialize the cycle theme button text
    updateCycleThemeBtnText();
  </script>
</body>
</html>
